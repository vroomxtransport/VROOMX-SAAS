---
phase: 01-project-setup-auth-multi-tenancy
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - next.config.ts
  - src/app/layout.tsx
  - src/app/page.tsx
  - src/app/globals.css
  - .env.local.example
  - .gitignore
  - src/types/index.ts
  - src/types/database.ts
autonomous: true

must_haves:
  truths:
    - "Next.js 16 dev server starts without errors on localhost:3000"
    - "All core dependencies are installed (supabase, stripe, sentry, posthog, drizzle, zod, tanstack-query, zustand)"
    - "shadcn/ui is initialized with Tailwind v4"
    - "Project directory structure matches the architecture spec"
    - "Environment variable template exists with all required keys documented"
  artifacts:
    - path: "package.json"
      provides: "All project dependencies"
      contains: "@supabase/supabase-js"
    - path: "next.config.ts"
      provides: "Next.js 16 configuration"
      contains: "nextConfig"
    - path: "src/app/layout.tsx"
      provides: "Root layout"
      min_lines: 10
    - path: ".env.local.example"
      provides: "Environment variable template"
      contains: "NEXT_PUBLIC_SUPABASE_URL"
    - path: "src/types/database.ts"
      provides: "Database type stubs for tenant tables"
      contains: "Tenant"
  key_links:
    - from: "next.config.ts"
      to: "src/app/layout.tsx"
      via: "Next.js App Router"
      pattern: "export default"
---

<objective>
Scaffold the VroomX SaaS project with Next.js 16, install all dependencies, initialize shadcn/ui, create the project directory structure, and set up environment variable templates.

Purpose: This is the absolute foundation. Every other plan depends on this project existing and the dependency tree being installed.
Output: A running Next.js 16 dev server with all libraries installed, shadcn/ui configured, and project structure in place.
</objective>

<execution_context>
@/Users/reepsy/.claude/get-shit-done/workflows/execute-plan.md
@/Users/reepsy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/reepsy/Desktop/VROOMX_SAAS/.planning/PROJECT.md
@/Users/reepsy/Desktop/VROOMX_SAAS/.planning/ROADMAP.md
@/Users/reepsy/Desktop/VROOMX_SAAS/.planning/STATE.md
@/Users/reepsy/Desktop/VROOMX_SAAS/.planning/phases/01-project-setup-auth-multi-tenancy/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Next.js 16 project and install all dependencies</name>
  <files>
    package.json
    tsconfig.json
    next.config.ts
    .gitignore
  </files>
  <action>
    1. Run `npx create-next-app@latest vroomx --yes` in a temporary location (it uses defaults: TypeScript, Tailwind v4, ESLint, App Router, Turbopack, src/ directory). Then move the contents into the project root `/Users/reepsy/Desktop/VROOMX_SAAS/` (preserving the existing .planning/ and .git/ directories).

    IMPORTANT: create-next-app creates a NEW directory. You need to:
    - Run it in /tmp or similar
    - Copy the generated files INTO the existing project root
    - Do NOT overwrite .git/ or .planning/

    2. Install core dependencies:
    ```bash
    npm install @supabase/supabase-js @supabase/ssr stripe @sentry/nextjs posthog-js zod @tanstack/react-query zustand
    ```

    3. Install ORM dependencies:
    ```bash
    npm install drizzle-orm postgres
    npm install -D drizzle-kit
    ```

    4. Install test dependencies:
    ```bash
    npm install -D vitest @playwright/test
    ```

    5. Initialize shadcn/ui:
    ```bash
    npx shadcn@latest init
    ```
    Accept defaults (New York style, neutral base color). This configures Tailwind v4 integration and creates `src/components/ui/`.

    6. Install initial shadcn/ui components needed for Phase 1:
    ```bash
    npx shadcn@latest add button input label card separator
    ```

    7. Update `.gitignore` to include:
    ```
    .env.local
    .env*.local
    node_modules/
    .next/
    .vercel/
    .sentry/
    ```
    Preserve any existing entries (like .planning/ gitignore rules if present).

    8. Update `next.config.ts` to add PostHog reverse proxy rewrites:
    ```typescript
    import type { NextConfig } from 'next'

    const nextConfig: NextConfig = {
      async rewrites() {
        return [
          {
            source: '/ingest/:path*',
            destination: 'https://us.i.posthog.com/:path*',
          },
        ]
      },
    }

    export default nextConfig
    ```
    NOTE: Sentry will wrap this config later (Plan 08). Keep it simple for now.
  </action>
  <verify>
    Run `npm run dev` and confirm the dev server starts on localhost:3000 without errors.
    Run `npm ls @supabase/supabase-js stripe drizzle-orm @sentry/nextjs posthog-js` to verify all core deps are installed.
    Verify `src/components/ui/button.tsx` exists (shadcn/ui initialized).
  </verify>
  <done>
    Next.js 16 dev server runs cleanly. All 13+ dependencies installed. shadcn/ui initialized with button, input, label, card, separator components.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create project directory structure, types, and env template</name>
  <files>
    src/lib/supabase/.gitkeep
    src/lib/stripe/.gitkeep
    src/db/.gitkeep
    src/hooks/.gitkeep
    src/stores/.gitkeep
    src/types/index.ts
    src/types/database.ts
    src/components/layout/.gitkeep
    .env.local.example
    drizzle.config.ts
  </files>
  <action>
    1. Create the directory structure (create directories and placeholder files):
    ```
    src/
      lib/
        supabase/       # Will hold client.ts, server.ts, service-role.ts, proxy.ts
        stripe/         # Will hold config.ts, webhook-handlers.ts
      db/               # Will hold schema.ts, index.ts (Drizzle)
      hooks/            # Custom React hooks
      stores/           # Zustand stores
      types/            # Shared TypeScript types
      components/
        layout/         # Sidebar, header, nav
    ```
    Use empty `.gitkeep` files in directories that will be populated by later plans.

    2. Create `src/types/index.ts` with the core type definitions that multiple plans will need:
    ```typescript
    // Tenant roles
    export type TenantRole = 'owner' | 'admin' | 'dispatcher' | 'viewer'

    // Subscription plans
    export type SubscriptionPlan = 'starter' | 'pro' | 'enterprise'

    // Subscription status
    export type SubscriptionStatus = 'trialing' | 'active' | 'past_due' | 'canceled' | 'unpaid'

    // Tier limits
    export const TIER_LIMITS: Record<SubscriptionPlan, { trucks: number; users: number }> = {
      starter: { trucks: 5, users: 3 },
      pro: { trucks: 20, users: 10 },
      enterprise: { trucks: Infinity, users: Infinity },
    }

    // Pricing (monthly, in dollars)
    export const TIER_PRICING: Record<SubscriptionPlan, number> = {
      starter: 49,
      pro: 149,
      enterprise: 299,
    }
    ```

    3. Create `src/types/database.ts` with TypeScript types matching the Supabase schema (these will be used before Drizzle schema is wired):
    ```typescript
    export interface Tenant {
      id: string
      name: string
      slug: string
      plan: string
      subscription_status: string
      stripe_customer_id: string | null
      stripe_subscription_id: string | null
      trial_ends_at: string | null
      created_at: string
      updated_at: string
    }

    export interface TenantMembership {
      id: string
      tenant_id: string
      user_id: string
      role: string
      created_at: string
      updated_at: string
    }

    export interface StripeEvent {
      id: string
      event_id: string
      event_type: string
      processed_at: string
    }
    ```

    4. Create `.env.local.example` with ALL environment variables needed for Phase 1:
    ```bash
    # Supabase (Public)
    NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
    NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY=sb_publishable_...

    # Supabase (Secret - server only)
    SUPABASE_SECRET_KEY=sb_secret_...

    # Database (server only)
    DATABASE_URL=postgresql://postgres.ref:password@aws-0-region.pooler.supabase.com:6543/postgres
    DATABASE_URL_DIRECT=postgresql://postgres.ref:password@aws-0-region.supabase.com:5432/postgres

    # Stripe
    STRIPE_SECRET_KEY=sk_test_...
    STRIPE_WEBHOOK_SECRET=whsec_...
    STRIPE_STARTER_PRICE_ID=price_...
    STRIPE_PRO_PRICE_ID=price_...
    STRIPE_ENTERPRISE_PRICE_ID=price_...

    # App
    NEXT_PUBLIC_APP_URL=http://localhost:3000

    # Sentry
    SENTRY_DSN=https://...@sentry.io/...
    SENTRY_AUTH_TOKEN=sntrys_...

    # PostHog
    NEXT_PUBLIC_POSTHOG_KEY=phc_...
    NEXT_PUBLIC_POSTHOG_HOST=https://us.i.posthog.com
    ```

    5. Create `drizzle.config.ts`:
    ```typescript
    import 'dotenv/config'
    import { defineConfig } from 'drizzle-kit'

    export default defineConfig({
      out: './supabase/migrations',
      schema: './src/db/schema.ts',
      dialect: 'postgresql',
      dbCredentials: {
        url: process.env.DATABASE_URL_DIRECT!,
      },
    })
    ```

    6. Update `src/app/page.tsx` to a simple placeholder that confirms the app is running:
    ```tsx
    export default function Home() {
      return (
        <main className="flex min-h-screen flex-col items-center justify-center">
          <h1 className="text-4xl font-bold">VroomX TMS</h1>
          <p className="mt-4 text-muted-foreground">SaaS Transportation Management System</p>
        </main>
      )
    }
    ```
  </action>
  <verify>
    Verify all directories exist: `ls src/lib/supabase src/lib/stripe src/db src/hooks src/stores src/types src/components/layout`
    Verify type files compile: `npx tsc --noEmit src/types/index.ts src/types/database.ts` (or run full `npx tsc --noEmit`)
    Verify `.env.local.example` exists with all 14+ env vars listed.
    Verify `drizzle.config.ts` exists.
  </verify>
  <done>
    Project structure created with all directories. Core TypeScript types defined (TenantRole, SubscriptionPlan, SubscriptionStatus, Tenant, TenantMembership, StripeEvent). Env template documents all required secrets. Drizzle config points to correct paths.
  </done>
</task>

</tasks>

<verification>
- `npm run dev` starts Next.js 16 dev server on localhost:3000
- `npm ls` shows all dependencies installed without missing peer deps
- `src/components/ui/button.tsx` exists (shadcn/ui working)
- `src/types/index.ts` and `src/types/database.ts` compile without errors
- `.env.local.example` lists all 14+ environment variables
- `drizzle.config.ts` exists with correct schema path
</verification>

<success_criteria>
- Next.js 16 dev server runs on localhost:3000
- All core + supporting dependencies installed
- shadcn/ui initialized with button, input, label, card, separator
- Project directory structure matches architecture spec
- TypeScript types for tenants/roles/plans defined
- Env template complete
- drizzle.config.ts configured
</success_criteria>

<output>
After completion, create `.planning/phases/01-project-setup-auth-multi-tenancy/01-01-SUMMARY.md`
</output>
