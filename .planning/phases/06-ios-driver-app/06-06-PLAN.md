---
phase: 06-ios-driver-app
plan: 06
type: execute
wave: 3
depends_on: ["06-03", "06-04"]
files_modified:
  - VroomXDriver/Views/Trips/TripsView.swift
  - VroomXDriver/Views/Trips/TripDetailView.swift
  - VroomXDriver/Views/Trips/AllTripsView.swift
  - VroomXDriver/Views/Main/MainTabView.swift
autonomous: true

must_haves:
  truths:
    - "Driver sees list of assigned trips with status, dates, and route summary"
    - "Trip detail shows orders, financials, expenses, and status workflow"
    - "Driver can view trip history (all trips, not just active)"
    - "Trip financial summary shows revenue, driver pay, expenses, and net"
  artifacts:
    - path: "VroomXDriver/Views/Trips/TripsView.swift"
      provides: "Trip list view with active and recent trips"
      contains: "TripsView"
    - path: "VroomXDriver/Views/Trips/TripDetailView.swift"
      provides: "Full trip detail with orders, financials, expenses, status"
      contains: "TripDetailView"
  key_links:
    - from: "VroomXDriver/Views/Trips/TripsView.swift"
      to: "VroomXDriver/Core/DataManager.swift"
      via: "Reads trips from DataManager"
      pattern: "DataManager\\.shared\\.trips"
    - from: "VroomXDriver/Views/Trips/TripDetailView.swift"
      to: "VroomXDriver/Core/DataManager.swift"
      via: "Fetches orders and expenses for specific trip"
      pattern: "fetchOrdersForTrip"
---

<objective>
Build the Trips tab with trip list, trip detail (orders, financials, expenses, status), and trip history.

Purpose: Trips are the driver's primary work unit. The Trips tab shows assigned trips and allows drilling into trip details including financial breakdown and order list.

Output: TripsView, TripDetailView, AllTripsView replacing the Trips tab placeholder
</objective>

<execution_context>
@/Users/reepsy/.claude/get-shit-done/workflows/execute-plan.md
@/Users/reepsy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/06-ios-driver-app/06-CONTEXT.md
@.planning/phases/06-ios-driver-app/06-03-SUMMARY.md
@.planning/phases/06-ios-driver-app/06-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build TripsView (trip list) and AllTripsView (trip history)</name>
  <files>
    VroomXDriver/Views/Trips/TripsView.swift
    VroomXDriver/Views/Trips/AllTripsView.swift
    VroomXDriver/Views/Main/MainTabView.swift
  </files>
  <action>
**TripsView.swift:**
- NavigationStack for drill-down to trip detail
- **Active trips section:** Trips with status in [planned, in_progress, at_terminal]
  - Each trip card shows: trip_number, status badge (colored), date range (start_date - end_date), origin_summary -> destination_summary route, order_count, total_revenue formatted as currency
  - Trip card tappable -> NavigationLink to TripDetailView(trip:)
- **Recent completed section:** Last 5 trips with status == completed, collapsed by default (DisclosureGroup)
- "View All Trips" navigation link to AllTripsView
- Pull-to-refresh
- Empty state: "No active trips" with truck icon
- Observe DataManager.shared.trips

**AllTripsView.swift:**
- Full trip history list (all statuses)
- Grouped by status: Active (planned/in_progress/at_terminal), Completed
- Search bar to filter by trip_number
- Each row same format as TripsView trip cards
- NavigationLink to TripDetailView

**Update MainTabView.swift:**
- Replace Trips tab placeholder `Text("Trips")` with `TripsView()`
  </action>
  <verify>TripsView shows active trips with status badges and route info. AllTripsView shows complete trip history with search.</verify>
  <done>Trip list shows active trips prominently with route and financial summary; history accessible via All Trips</done>
</task>

<task type="auto">
  <name>Task 2: Build TripDetailView with orders, financials, expenses, and status</name>
  <files>VroomXDriver/Views/Trips/TripDetailView.swift</files>
  <action>
**TripDetailView.swift:**
Takes `trip: VroomXTrip` as input. Loads orders and expenses on appear.

- **Header:** Trip number, status badge, date range
- **Route section:** Origin summary -> Destination summary with map icon
- **Status workflow:** Visual progress bar showing planned -> in_progress -> at_terminal -> completed. Current status highlighted.

- **Financial summary card** (cardBackground with border):
  - Total Revenue: trip.total_revenue formatted as currency
  - Carrier Pay: trip.carrier_pay
  - Broker Fees: trip.total_broker_fees
  - Driver Pay: trip.driver_pay (highlighted in brandPrimary â€” this is what the driver cares about most)
  - Total Expenses: trip.total_expenses
  - Net Profit: trip.net_profit (green if positive, red if negative)
  - Layout: 2-column grid of label + value pairs, driver pay emphasized

- **Orders section:**
  - Section header: "Orders ({count})"
  - List of OrderCardView for each order in the trip (fetched via DataManager.fetchOrdersForTrip)
  - NavigationLink on each order card -> OrderDetailView

- **Expenses section:**
  - Section header: "Expenses ({count})" with "Add Expense" button
  - List of expenses: category icon, custom_label or category name, amount, date
  - Swipe-to-delete on each expense (calls DataManager.deleteExpense)
  - "Add Expense" opens a sheet with: category picker (fuel/tolls/repairs/lodging/misc), amount field (decimal keypad), notes field, date picker, "Save" button
  - Expense creation via DataManager.createExpense

- **Notes section:** trip.notes if present
- On appear: `Task { tripOrders = await DataManager.shared.fetchOrdersForTrip(tripId: trip.id); tripExpenses = await DataManager.shared.fetchExpenses(tripId: trip.id) }`
  </action>
  <verify>TripDetailView shows financial card with 6 metrics, order list, expense list with add/delete, and status progress bar.</verify>
  <done>Trip detail gives driver full context: route, financials, orders, and expenses with add/delete expense capability</done>
</task>

</tasks>

<verification>
- TripsView shows active trips grouped by status
- TripDetailView displays all financial fields from the trips table
- Driver pay is visually emphasized (it is the driver's primary concern)
- Expense CRUD works (add via sheet, delete via swipe)
- Financial values formatted as currency with 2 decimal places
- Order cards in trip detail navigate to order detail (view built in Plan 07)
</verification>

<success_criteria>
- Driver can see all assigned trips with route and financial summary
- Trip detail shows full financial breakdown, orders list, and expenses
- Expenses can be added and deleted from trip detail
- Trip history is searchable
</success_criteria>

<output>
After completion, create `.planning/phases/06-ios-driver-app/06-06-SUMMARY.md`
</output>
