---
phase: 06-ios-driver-app
plan: 13
type: execute
wave: 3
depends_on: ["06-03", "06-04"]
files_modified:
  - VroomXDriver/Views/Profile/ProfileView.swift
  - VroomXDriver/Views/Main/MainTabView.swift
autonomous: true

must_haves:
  truths:
    - "Profile shows driver name, email, and stats (total trips, total earnings)"
    - "Theme toggle switches between dark and light mode"
    - "Sign out clears all data and returns to login screen"
    - "Cache/sync info shows last sync time and pending actions count"
  artifacts:
    - path: "VroomXDriver/Views/Profile/ProfileView.swift"
      provides: "Profile tab with driver info, stats, theme toggle, sign out"
      contains: "ProfileView"
  key_links:
    - from: "VroomXDriver/Views/Profile/ProfileView.swift"
      to: "VroomXDriver/Core/AuthManager.swift"
      via: "logout() call on sign out"
      pattern: "authManager\\.logout"
    - from: "VroomXDriver/Views/Profile/ProfileView.swift"
      to: "VroomXDriver/Theme/ThemeManager.swift"
      via: "Toggle isDarkMode"
      pattern: "themeManager\\.isDarkMode"
---

<objective>
Build the Profile tab with driver information, stats, theme toggle, cache info, and sign out.

Purpose: The Profile tab provides settings, preferences, and account management. It is the driver's self-service control panel.

Output: ProfileView replacing the Profile tab placeholder
</objective>

<execution_context>
@/Users/reepsy/.claude/get-shit-done/workflows/execute-plan.md
@/Users/reepsy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/06-ios-driver-app/06-CONTEXT.md
@.planning/phases/06-ios-driver-app/06-03-SUMMARY.md
@.planning/phases/06-ios-driver-app/06-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build ProfileView with driver info, stats, preferences, and sign out</name>
  <files>
    VroomXDriver/Views/Profile/ProfileView.swift
    VroomXDriver/Views/Main/MainTabView.swift
  </files>
  <action>
**ProfileView.swift:**
ScrollView layout with sections:

- **Driver info header:**
  - Large initials avatar circle (driver initials in white on brandPrimary background)
  - Full name (first_name + last_name) in titleMedium font
  - Email address below name in textSecondary
  - Driver type badge: "Company Driver" or "Owner Operator"
  - License number (if present)

- **Stats section** (2x2 grid of stat cards):
  - Total Trips: count of all trips
  - Active Trips: count of trips with status in [planned, in_progress, at_terminal]
  - Total Earnings: sum of driver_pay across all completed trips, formatted as currency
  - Current Period: earnings for current pay period
  - Each card: SF Symbol icon, number (large mono), label

- **Preferences section** (Form/List style):
  - **Theme toggle:** "Dark Mode" with Toggle bound to themeManager.isDarkMode
    - Sun/moon icon to indicate current mode
  - **Biometric unlock:** "Face ID / Touch ID" with Toggle bound to biometric enabled state
    - Show which biometric type is available (LAContext.biometryType)
  - **Notifications:** "Push Notifications" â€” navigates to iOS Settings if permissions denied
    - Show current permission state (enabled/disabled)

- **App info section:**
  - App version: Config.appVersion
  - Cache info: "Last sync: {time ago}" based on last successful DataManager fetch
  - Pending actions: "{n} pending syncs" from PendingActionsQueue.shared count
  - "Clear Cache" button: clears CacheManager data (with confirmation alert)

- **Sign out section:**
  - "Sign Out" button (brandDanger color, prominent)
  - Confirmation alert: "Are you sure? All cached data will be cleared."
  - On confirm:
    1. Call DataManager.shared.teardown() (stop Realtime, clear state)
    2. Call NotificationManager.shared.deregisterDeviceToken() (remove push token)
    3. Call PendingActionsQueue.shared.clearQueue()
    4. Call InspectionUploadQueue.shared.clearQueue()
    5. Call authManager.logout() (Keychain clear, CacheManager clear, Supabase sign out)
    6. App returns to LoginView via authManager.isAuthenticated = false

- **Footer:** "VroomX Driver v{version}" centered in textSecondary

**Update MainTabView.swift:**
- Replace Profile tab placeholder with `ProfileView()`
  </action>
  <verify>ProfileView shows driver info, stats, theme toggle, cache info, and sign out. Sign out clears all data sources. MainTabView Profile tab is wired.</verify>
  <done>Profile tab provides driver self-service: stats, theme preferences, biometric settings, cache management, and secure sign out</done>
</task>

</tasks>

<verification>
- Driver name and email shown from AuthManager.currentDriver
- Stats calculated from DataManager.shared.trips
- Theme toggle immediately switches color scheme
- Sign out calls all teardown methods in correct order (DataManager, NotificationManager, PendingActionsQueue, InspectionUploadQueue, AuthManager)
- After sign out, app returns to LoginView with clean state
- No cached data remains after sign out (Pitfall 7 addressed)
</verification>

<success_criteria>
- Profile shows accurate driver information and stats
- Theme toggles between dark and light mode
- Sign out clears all local data and deregisters push token
- App returns to login screen after sign out
</success_criteria>

<output>
After completion, create `.planning/phases/06-ios-driver-app/06-13-SUMMARY.md`
</output>
