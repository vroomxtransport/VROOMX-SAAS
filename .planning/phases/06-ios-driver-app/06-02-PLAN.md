---
phase: 06-ios-driver-app
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - VroomXDriver/Theme/ThemeManager.swift
  - VroomXDriver/Theme/Colors.swift
  - VroomXDriver/Theme/Typography.swift
  - VroomXDriver/Models/Driver.swift
  - VroomXDriver/Models/Trip.swift
  - VroomXDriver/Models/Order.swift
  - VroomXDriver/Models/Expense.swift
  - VroomXDriver/Models/Inspection.swift
  - VroomXDriver/Models/Notification.swift
  - VroomXDriver/Models/Settlement.swift
  - VroomXDriver/Models/Enums.swift
  - VroomXDriver/Core/SupabaseManager.swift
  - VroomXDriver/Core/NetworkMonitor.swift
  - VroomXDriver/Core/CacheManager.swift
autonomous: true

must_haves:
  truths:
    - "All model structs use String (UUID) IDs, never Int"
    - "Models match VroomX actual database schema (migrations 00002, 00003, 00006)"
    - "Theme system provides dark mode (default) and light mode with VroomX brand colors"
    - "SupabaseManager provides a singleton Supabase client"
    - "NetworkMonitor tracks online/offline state"
    - "CacheManager stores and retrieves JSON data in UserDefaults"
  artifacts:
    - path: "VroomXDriver/Models/Order.swift"
      provides: "VroomXOrder model matching actual schema"
      contains: "let id: String"
    - path: "VroomXDriver/Theme/Colors.swift"
      provides: "VroomX brand color palette"
      contains: "brandPrimary"
    - path: "VroomXDriver/Core/SupabaseManager.swift"
      provides: "Singleton Supabase client"
      contains: "SupabaseClient"
  key_links:
    - from: "VroomXDriver/Core/SupabaseManager.swift"
      to: "VroomXDriver/Config.swift"
      via: "Config.supabaseURL and Config.supabaseAnonKey"
      pattern: "Config\\.supabase"
    - from: "VroomXDriver/Models/Order.swift"
      to: "supabase/migrations/00002_core_entities.sql"
      via: "Field names match database columns exactly"
      pattern: "pickup_contact_name"
---

<objective>
Create the theme system, all data model structs, and core infrastructure (Supabase client, network monitor, cache manager).

Purpose: Every subsequent plan depends on models, theme, and core services. Building these first enables parallel development of auth, data layer, and UI.

Output: Theme files, 7 model files, 3 core service files
</objective>

<execution_context>
@/Users/reepsy/.claude/get-shit-done/workflows/execute-plan.md
@/Users/reepsy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/06-ios-driver-app/06-RESEARCH.md
@src/types/database.ts
@supabase/migrations/00002_core_entities.sql
@supabase/migrations/00003_trips_and_dispatch.sql
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create theme system (ThemeManager, Colors, Typography)</name>
  <files>
    VroomXDriver/Theme/ThemeManager.swift
    VroomXDriver/Theme/Colors.swift
    VroomXDriver/Theme/Typography.swift
  </files>
  <action>
**ThemeManager.swift:**
- `ThemeManager` class conforming to `ObservableObject`
- `@AppStorage("appTheme") var isDarkMode: Bool = true` (dark mode default per CONTEXT.md)
- Computed `colorScheme: ColorScheme` property
- Inject as `@EnvironmentObject` in app entry point

**Colors.swift:**
- Extension on `Color` with VroomX brand palette (NOT Horizon green):
  - `brandPrimary`: #3B82F6 dark / #2563EB light (deep blue)
  - `brandAccent`: #8B5CF6 dark / #7C3AED light (violet)
  - `brandSuccess`: #22C55E dark / #16A34A light (green — status only, not brand)
  - `brandWarning`: #F59E0B dark / #D97706 light (amber)
  - `brandDanger`: #EF4444 dark / #DC2626 light (red)
  - `appBackground`: #09090B dark / #F8FAFC light
  - `cardBackground`: #18181B dark / #FFFFFF light
  - `textPrimary`: #FAFAFA dark / #0F172A light
  - `textSecondary`: #A1A1AA dark / #64748B light
- Use adaptive Color with dark/light variants via initializer that checks colorScheme
- Helper: `Color(hex:)` initializer for hex string to Color conversion

**Typography.swift:**
- Extension on `Font` with VroomX type scale:
  - `.vroomxTitleLarge`: system size 28, weight heavy
  - `.vroomxTitleMedium`: system size 20, weight heavy
  - `.vroomxTitle`: system size 17, weight bold
  - `.vroomxBody`: system size 14, weight regular
  - `.vroomxBodyBold`: system size 14, weight semibold
  - `.vroomxCaption`: system size 12, weight medium
  - `.vroomxCaptionSmall`: system size 10, weight semibold
  - `.vroomxMono`: system size 14, weight bold, monospacedDigit
  </action>
  <verify>All three theme files compile with valid Swift syntax and use VroomX brand colors (blue/violet, not Horizon green)</verify>
  <done>Theme system provides colors, typography, and dark/light mode toggle for the entire app</done>
</task>

<task type="auto">
  <name>Task 2: Create all data models and core infrastructure</name>
  <files>
    VroomXDriver/Models/Driver.swift
    VroomXDriver/Models/Trip.swift
    VroomXDriver/Models/Order.swift
    VroomXDriver/Models/Expense.swift
    VroomXDriver/Models/Inspection.swift
    VroomXDriver/Models/Notification.swift
    VroomXDriver/Models/Settlement.swift
    VroomXDriver/Models/Enums.swift
    VroomXDriver/Core/SupabaseManager.swift
    VroomXDriver/Core/NetworkMonitor.swift
    VroomXDriver/Core/CacheManager.swift
  </files>
  <action>
**CRITICAL: All model IDs are `let id: String` (UUID), never `Int`. Build from VroomX schema, NOT Horizon Star models.**

**Enums.swift:**
- `OrderStatus`: new, assigned, picked_up, delivered, invoiced, paid, cancelled (String, Codable)
- `TripStatus`: planned, in_progress, at_terminal, completed
- `PaymentType`: COD, COP, CHECK, BILL, SPLIT
- `ExpenseCategory`: fuel, tolls, repairs, lodging, misc
- `DriverType`: company, owner_operator
- `DriverPayType`: percentage_of_carrier_pay, dispatch_fee_percent, per_mile, per_car
- `InspectionType`: pickup, delivery
- `InspectionStatus`: in_progress, completed
- `DamageType`: scratch, dent, chip, broken, missing (with displayName, initial String "S"/"D"/"C"/"B"/"M", and color)
- `PhotoType`: odometer, front, left, right, rear, top, key_vin, custom_1 through custom_5
- `NotificationType`: trip_assignment, status_change, dispatch_message, urgent
- `OrderModule`: pickup, delivery, completed, archived (for Home tab filtering)

**Driver.swift** — `VroomXDriver: Codable, Identifiable`:
- Fields from VroomX `drivers` table: id, tenant_id, first_name, last_name, email, phone, address, city, state, zip, license_number, driver_type, driver_status, pay_type, pay_rate (Double), auth_user_id (String?), pin_hash (String?), notes, created_at, updated_at
- Computed: `fullName`, `initials`

**Trip.swift** — `VroomXTrip: Codable, Identifiable`:
- Fields from VroomX `trips` table: id, tenant_id, trip_number, driver_id, truck_id, status, start_date, end_date, carrier_pay (Double?), total_revenue (Double?), total_broker_fees (Double?), driver_pay (Double?), total_expenses (Double?), net_profit (Double?), order_count (Int?), origin_summary, destination_summary, notes, created_at, updated_at
- Computed: `dateRange` (formatted string), `isActive`

**Order.swift** — `VroomXOrder: Codable, Identifiable`:
- Fields from VroomX `orders` table (migration 00002 + 00003 + 00006): id, tenant_id, order_number, broker_id, driver_id, trip_id, vehicle_vin, vehicle_year (Int?), vehicle_make, vehicle_model, vehicle_type, vehicle_color, status, cancelled_reason, pickup_location, pickup_city, pickup_state, pickup_zip, pickup_contact_name, pickup_contact_phone, pickup_date, delivery_location, delivery_city, delivery_state, delivery_zip, delivery_contact_name, delivery_contact_phone, delivery_date, actual_pickup_date, actual_delivery_date, pickup_eta, delivery_eta, revenue (Double?), carrier_pay (Double?), broker_fee (Double?), payment_type, payment_status, invoice_date, amount_paid (Double?), notes, created_at, updated_at
- Computed: `vehicleDescription`, `pickupFullAddress`, `deliveryFullAddress`
- Use CodingKeys to map snake_case DB columns to Swift properties

**Expense.swift** — `VroomXExpense: Codable, Identifiable`:
- Fields: id, tenant_id, trip_id, category, custom_label, amount (Double), notes, expense_date, created_at, updated_at
- Struct `ExpenseCreate: Codable` for creating new expenses (trip_id, tenant_id, category, amount, description, expense_date, receipt_url)

**Inspection.swift:**
- `VehicleInspection: Codable, Identifiable` — id, tenant_id, order_id, driver_id, inspection_type, status, odometer_reading (Int?), interior_condition, notes, gps_latitude (Double?), gps_longitude (Double?), gps_address, driver_signature_url, customer_signature_url, customer_name, customer_notes, completed_at, created_at, updated_at
- `InspectionPhoto: Codable, Identifiable` — id, tenant_id, inspection_id, photo_type, storage_path, thumbnail_path, upload_status, created_at
- `InspectionVideo: Codable, Identifiable` — id, tenant_id, inspection_id, storage_path, duration_seconds (Int?), upload_status, created_at
- `InspectionDamage: Codable, Identifiable` — id, tenant_id, inspection_id, damage_type, view, x_position (Double), y_position (Double), description, created_at

**Notification.swift** — `DriverNotification: Codable, Identifiable`:
- id, tenant_id, driver_id, notification_type, title, body, data (String?), read_at, created_at

**Settlement.swift** — `Settlement` (computed, not stored in DB):
- pay_period_start: String, pay_period_end: String
- trips: [VroomXTrip]
- Computed: totalRevenue, totalDriverPay, totalExpenses, netEarnings, tripCount

**Core/SupabaseManager.swift:**
- Singleton `SupabaseManager` with `static let shared`
- `let client: SupabaseClient` initialized from Config.supabaseURL and Config.supabaseAnonKey
- `import Supabase`

**Core/NetworkMonitor.swift:**
- `NetworkMonitor: ObservableObject` using `NWPathMonitor`
- `@Published var isConnected: Bool = true`
- Start monitoring on init, update isConnected on path changes
- `import Network`

**Core/CacheManager.swift:**
- `CacheManager` class with `static let shared`
- `save<T: Encodable>(_ object: T, forKey key: String)` — encode to JSON, store in UserDefaults
- `load<T: Decodable>(_ type: T.Type, forKey key: String) -> T?` — load from UserDefaults, decode
- `remove(forKey key: String)` — remove from UserDefaults
- `clearAllCache()` — remove ALL VroomX keys (critical for logout/tenant switch per Pitfall 7)
- All cache keys prefixed with "vroomx_" to avoid collisions
  </action>
  <verify>All model files have `let id: String` (UUID, not Int). All enum rawValues match VroomX database enum values exactly. SupabaseManager imports Supabase. NetworkMonitor imports Network.</verify>
  <done>All data models match VroomX schema with UUID IDs, core services (Supabase client, network monitor, cache manager) are ready for use by auth and data layer plans</done>
</task>

</tasks>

<verification>
- Every model struct uses `let id: String` (UUID), never `Int`
- Order model includes pickup_eta and delivery_eta (from migration 00006)
- Driver model includes auth_user_id and pin_hash
- No Horizon Star branding in any file (no green, no "Horizon", no "LuckyCabbage")
- Color palette uses blue (#3B82F6) primary, violet (#8B5CF6) accent
- SupabaseManager creates a valid SupabaseClient
- CacheManager has clearAllCache() for logout safety
</verification>

<success_criteria>
- All model structs compile and match VroomX database schema exactly
- Theme provides dark mode default with professional VroomX blue/violet palette
- Core services are singletons ready for injection into SwiftUI views
</success_criteria>

<output>
After completion, create `.planning/phases/06-ios-driver-app/06-02-SUMMARY.md`
</output>
